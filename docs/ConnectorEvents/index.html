
<!doctype html>

<html>
<head>
  <meta name="viewport" content="width=device-width, minimum-scale=1.0, initial-scale=1.0, user-scalable=yes">
  <meta name="theme-color" content="#4F7DC9">
  <meta charset="UTF-8">
  <title>Data Hub Events</title>
  <link rel="stylesheet" href="//fonts.googleapis.com/css?family=Source+Code+Pro:400|Roboto:400,300,400italic,500,700|Roboto+Mono">
  <link rel="stylesheet" href="//fonts.googleapis.com/icon?family=Material+Icons">
  <link rel="stylesheet" href="https://storage.googleapis.com/codelab-elements/codelab-elements.css">
  <style>
    .success {
      color: #1e8e3e;
    }
    .error {
      color: red;
    }
  </style>
</head>
<body>
  <google-codelab-analytics gaid="UA-49880327-14"></google-codelab-analytics>
  <google-codelab codelab-gaid=""
                  id="ConnectorEvents"
                  title="Data Hub Events"
                  environment="web"
                  feedback-link="">
    
      <google-codelab-step label="Common Event Properties" duration="0">
        <p>All events contain these common properties:</p>
<pre><code>{
   &#34;type&#34;: &#34;...&#34;,                //The type of the event.
   &#34;streamId&#34;: &#34;...&#34;,            //The stream ID uniquely identifying the current request. This ID is the same across all software components which are involved in an XYZ request.
                                 //It should be used in every log-line being produced by the component to be able to find all logs for a single request in the logging system.
   &#34;ifNoneMatch&#34;: &#34;...&#34;,         //The etag of the request. The connector should respond with a NotModifiedResponse (see below) in case the ifNoneMatch field equals the etag of the response.
   &#34;connectorParams&#34;: { ... },   //Parameters coming from the connector configuration. These values are the same across all spaces using that connector and only differ per connector.
   &#34;params&#34;: { ... },            //Parameters for the connector(-registration), as defined in the space configuration.
   &#34;metadata&#34;: { ... }           //OPTIONAL: The metadata of the user&#39;s token having been used for the request (if existing at the used token).
}
</code></pre>
<p>The following response should be sent by storage connectors if the incoming &#34;ifNoneMatch&#34; field matches the etag of the response. In that case the user already has that version of the response in its cache.</p>
<pre><code>{
  &#34;type&#34;: &#34;NotModifiedResponse&#34;,    //The type of the response.
}
</code></pre>


      </google-codelab-step>
    
      <google-codelab-step label="HealthCheckEvent" duration="0">
        <p>Ask the XYZ Connector to report it&#39;s health status. To keep a lambda hot, it is recommended to send this request every two minutes to the lambda. The health check event may provide further additional information to the client, like which spaces it provides, in which sections its hot and so on. If no space is given the health status of the whole data provider should be returned, if a space is provided only the status of this space should be returned.</p>
<pre><code>{
  &#34;type&#34;: &#34;HealthCheckEvent&#34;,   //The type of the event.
  &#34;minResponseTime&#34;: 200,       //The time [ms] the connector should wait before responding that healthcheck. (To enforce concurrency during warmup)
  &#34;space&#34;: &#34;foo&#34;,               //If a space is given, the health status only for this space should be checked.
  &#34;params&#34;: {}                  //Parameters for the storage provider, as defined in the space configuration.
}
</code></pre>
<h3 is-upgraded>Success</h3>
<pre><code>{
  &#34;type&#34;: &#34;HealthStatus&#34;,
  &#34;status&#34;: &#34;OK&#34;            //The response for successful health check
}
</code></pre>
<h3 is-upgraded>Error</h3>
<pre><code>{
  &#34;type&#34;: &#34;HealthStatus&#34;,
  &#34;status&#34;: &#34;ERROR&#34;         //The response for unsuccessful health check
}
</code></pre>


      </google-codelab-step>
    
      <google-codelab-step label="GetStatisticsEvent" duration="0">
        <p>Ask the XYZ Connector to retrieve statistical information about all of the features for the space.</p>
<pre><code>{
  &#34;type&#34;: &#34;GetStatisticsEvent&#34;,          // The type of the event.
  &#34;space&#34;: &#34;foo&#34;,                   // The space for which the event was sent.
  &#34;params&#34;: {}
}
</code></pre>
<h3 is-upgraded>Success</h3>
<pre><code>{
  &#34;type&#34;: &#34;StatisticsResponse&#34;,                 //The type of the response.
  &#34;bbox&#34;: {
    &#34;value&#34;: [                                  //The bounding box around all features in that space
      -178.807692967444,
      -53.754469656116,
      179.781513034875,
      66.2707518592356
    ],
    &#34;estimated&#34;: false                          //Whether the information is estimated or exact
  },
  &#34;byteSize&#34;: {
    &#34;value&#34;: 2383872,                           //The amount of bytes the data occupies in the storage
    &#34;estimated&#34;: true                           //Whether the information is estimated or exact
  },
  &#34;count&#34;: {
    &#34;value&#34;: 2771,                              //The amount of features that are in the space
    &#34;estimated&#34;: false                          //Whether the information is estimated or exact
  },
  &#34;geometryTypes&#34;: {                            //Quantitative information about the different geometry types in the space
    &#34;value&#34;: [
      &#34;Point&#34;
    ],
    &#34;estimated&#34;: false                          //Whether the information is estimated or exact
  },
  &#34;properties&#34;: {                               //Quantitative information about the different property keys of the features
    &#34;value&#34;: [
      {
        &#34;key&#34;: &#34;color&#34;,
        &#34;count&#34;: 1822,
        &#34;searchable&#34;: true                      //Whether it&#39;s possible to search by values of this property. (Will only be set if the global &#34;searchable&#34; field has the value &#34;PARTIAL&#34;)
      }
    ],
    &#34;estimated&#34;: true,                          //Whether the information is estimated or exact
    &#34;searchable&#34;: &#34;NONE&#34; | &#34;PARTIAL&#34; | &#34;ALL&#34;    //&#34;NONE&#34; means that searching on properties won&#39;t work at all. &#34;PARTIAL&#34; means the information which property is searchable can be found above for each feature. &#34;ALL&#34; means search works for all properties.
  },
  &#34;tags&#34;: {
    &#34;value&#34;: [
        {
            &#34;key&#34;: &#34;stadium&#34;,                   //The tag name
            &#34;count&#34;: 734                        //The amount of objects having that tag
        },
        ...
    ],
    &#34;estimated&#34;: true                           //Whether the information is estimated or exact
  },
  &#34;etag&#34;: &#34;ac240d3a7de3e26c&#34;,
  &#34;streamId&#34;: &#34;677e7ef2-8226-11e9-8ad2-e1130c97dba9&#34;
}
</code></pre>
<h3 is-upgraded>Error</h3>
<pre><code>{
  &#34;type&#34;: &#34;ErrorResponse&#34;,      //The type of the response.
  &#34;error&#34;: &#34;NotSupported&#34;,      //Signaling that this lambda does not support the event.
  &#34;errorMessage&#34;: &#34;This storage connector does not support gathering statistics about the space.&#34;
}
</code></pre>


      </google-codelab-step>
    
      <google-codelab-step label="GetFeaturesByIdEvent" duration="0">
        <p>Ask the XYZ Connector to return features with a specific ‘id&#39;.</p>
<pre><code>{
  &#34;type&#34;: &#34;GetFeaturesByIdEvent&#34;,     // The type of the event.
  &#34;space&#34;: &#34;foo&#34;,                     // The space for which the event was sent.
  &#34;params&#34;: {},                       // Parameters for the storage provider, as defined in the space configuration.
  &#34;ids&#34;: [                            // The unique identifiers of the features to return.
    &#34;Q3495887&#34;,
    &#34;X4353454&#34;
  ],
  &#34;selection&#34;: [&#34;properties.name&#34;,&#34;properties.capacity&#34;,&#34;properties.@ns:com:here:xyz&#34;,&#34;properties.occupant&#34;,&#34;properties.sport&#34;]      // if set, only the specified properties should be included in the response 
}
</code></pre>
<h3 is-upgraded>Success</h3>
<pre><code>{
     &#34;type&#34;: &#34;FeatureCollection&#34;,     // The type of the response.
     &#34;features&#34;: [                    // The features that where found in random order.
          {
            &#34;geometry&#34;: {
                &#34;type&#34;: &#34;Point&#34;,
                &#34;coordinates&#34;: [
                    15.3222,
                    -4.33806
                ]
            },
            &#34;id&#34;: &#34;Q3495887&#34;,
            &#34;type&#34;: &#34;Feature&#34;,
            &#34;properties&#34;: {
                &#34;name&#34;: &#34;Stade Tata Raphaël&#34;,
                &#34;@ns:com:here:xyz&#34;: {
                    &#34;tags&#34;: [
                        &#34;stadium&#34;,
                        &#34;soccer&#34;
                    ]
                },
                &#34;occupant&#34;: &#34;Daring Club Motema Pembe&#34;,
                &#34;sport&#34;: &#34;association football&#34;,
                &#34;capacity&#34;: 50000
            }
        }
     ]
}    
</code></pre>
<h3 is-upgraded>Error</h3>
<pre><code>{
  &#34;type&#34;: &#34;ErrorResponse&#34;,              //The type of the response.
  &#34;error&#34;: &#34;NotImplemented&#34;,            //Signaling that this lambda does not implement the event.
  &#34;errorMessage&#34;: &#34;Requesting features by id is not supported.&#34;
}
</code></pre>


      </google-codelab-step>
    
      <google-codelab-step label="GetFeaturesByBBoxEvent" duration="0">
        <p>Ask the XYZ Connector to return all features in the given bounding box, optionally filtered by those having certain tags.</p>
<pre><code>{
  &#34;type&#34;: &#34;GetFeaturesByBBoxEvent&#34;,     //The type of the event.
  &#34;space&#34;: &#34;foo&#34;,                       //The space for which the event was sent.
  &#34;params&#34;: {},                         //Parameters for the storage provider, as defined in the space configuration.
  &#34;tags&#34;: [                             //Only return features with the tags:
    [&#34;stadium&#34;],                        //&#34;stadium&#34; OR
    [&#34;soccer&#34;]                          //&#34;soccer&#34;
  ],
  &#34;bbox&#34;: [                             //The bounding box:
    9.052734375,                        //Minimal longitude in decimal degree.
    50.06419173665909,                  //Minimal latitude in decimal degree.
    9.140625,                           //Maximal longitude in decimal degree.
    50.12057809796007                   //Maximal latitude in decimal degree.
  ],
  &#34;clip&#34;: true,                         //True if the geometries should be clipped to the bounding box.
  &#34;limit&#34;: 1000,                        //The maximal amount of features to be returned.
  &#34;propertiesQuery&#34;: [[                 //A properties query
    {
      &#34;key&#34;:&#34;capacity&#34;,
      &#34;operation&#34;: &#34;EQUALS&#34;,
      &#34;values&#34;: [50000]
    }
  ]],
  &#34;selection&#34;: [&#34;properties.name&#34;,&#34;properties.capacity&#34;,&#34;properties.@ns:com:here:xyz&#34;,&#34;properties.occupant&#34;,&#34;properties.sport&#34;]     //if set, only the specified properties are included in the response
}
</code></pre>
<h3 is-upgraded>Success</h3>
<pre><code>{
  &#34;type&#34;: &#34;FeatureCollection&#34;,  //The type of the response.
  &#34;features&#34;: [                 //The features that were found in random order.
    {
      &#34;geometry&#34;: {
        &#34;type&#34;: &#34;Point&#34;,
        &#34;coordinates&#34;: [
          15.3222,
          -4.33806
        ]
      },
      &#34;id&#34;: &#34;Q3495887&#34;,
      &#34;type&#34;: &#34;Feature&#34;,
      &#34;properties&#34;: {
        &#34;name&#34;: &#34;Stade Tata Raphaël&#34;,
        &#34;@ns:com:here:xyz&#34;: {
          &#34;tags&#34;: [
            &#34;stadium&#34;,
            &#34;soccer&#34;
          ],
          &#34;version&#34;: 36879      //The space-version of the feature within the history of its space.
        },
        &#34;occupant&#34;: &#34;Daring Club Motema Pembe&#34;,
        &#34;sport&#34;: &#34;association football&#34;,
        &#34;capacity&#34;: 50000
      }
    },
    ...                         //More features.
  ]
}
</code></pre>
<h3 is-upgraded>Error</h3>
<pre><code>{
     &#34;type&#34;: &#34;FeatureCollection&#34;,        // The type of the response.
     &#34;error&#34;: &#34;NotSupported&#34;,            // Signaling that this lambda does not support the event.
     &#34;errorMessage&#34;: &#34;Clipping is not supported.&#34;
}
</code></pre>


      </google-codelab-step>
    
      <google-codelab-step label="GetFeaturesByTileEvent" duration="0">
        <p>Ask the XYZ Connector to return all features in the given tile, optionally filtered by those having certain tags.</p>
<pre><code>{
     &#34;type&#34;: &#34;GetFeaturesByTileEvent&#34;,   // The type of the event.
     &#34;space&#34;: &#34;foo&#34;,                     // The space for which the event was sent.
     &#34;params&#34;: {},                       // Parameters for the storage provider, as defined in the space configuration.
     &#34;tags&#34;: [                           // Only return features with the tags:
          [&#34;stadium&#34;, &#34;soccer&#34;]          // &#34;stadium&#34; AND &#34;soccer&#34;
     ],
     &#34;bbox&#34;: [                           // The bounding box of the tile:
          9.052734375,                   // Minimal longitude in decimal degree.
          50.06419173665909,             // Minimal latitude in decimal degree.
          9.140625,                      // Maximal longitude in decimal degree.
          50.12057809796007              // Maximal latitude in decimal degree.
     ],
     &#34;clip&#34;: true,                       // True if the geometries should be clipped to the tile.
     &#34;limit&#34;: 1000,                      // The maximal amount of features to be returned.
     &#34;quadkey&#34;: &#34;120203302133&#34;,          // The quadkey as used by Microsoft Bing.
     &#34;x&#34;: 2151,                          // The web mercator x coordinate of the tile.
     &#34;y&#34;: 1387,                          // The web mercator y coordinate of the tile.
     &#34;level&#34;: 12,                        // The web mercator zoom level of the tile.
     &#34;buffer&#34;: 0                         // The margin (additional pixel around the tile to fetch).
}
</code></pre>
<h3 is-upgraded>Success</h3>
<pre><code>{
     &#34;type&#34;: &#34;FeatureCollection&#34;,        // The type of the response.
     &#34;features&#34;: [                       // The features that were found in random order.
          {
            &#34;geometry&#34;: {
                &#34;type&#34;: &#34;Point&#34;,
                &#34;coordinates&#34;: [
                    15.3222,
                    -4.33806
                ]
            },
            &#34;id&#34;: &#34;Q3495887&#34;,
            &#34;type&#34;: &#34;Feature&#34;,
            &#34;properties&#34;: {
                &#34;name&#34;: &#34;Stade Tata Raphaël&#34;,
                &#34;@ns:com:here:xyz&#34;: {
                    &#34;tags&#34;: [
                        &#34;stadium&#34;,
                        &#34;soccer&#34;
                    ]
                },
                &#34;occupant&#34;: &#34;Daring Club Motema Pembe&#34;,
                &#34;sport&#34;: &#34;association football&#34;,
                &#34;capacity&#34;: 50000
            }
        },
          ...                            // More features.
     ]
}
</code></pre>
<h3 is-upgraded>Error</h3>
<pre><code>{
     &#34;type&#34;: &#34;FeatureCollection&#34;,        // The type of the response.
     &#34;error&#34;: &#34;NotImplemented&#34;,          // Signaling that this lambda does not implement the event.
     &#34;errorMessage&#34;: &#34;Tile requests are not implemented.&#34;
}
</code></pre>


      </google-codelab-step>
    
      <google-codelab-step label="GetFeaturesByGeometryEvent" duration="0">
        <p>Ask the XYZ Connector to return all features at a certain longitude and latitude (GET) and an optional radius in meters or within or around a certain geometry (POST). Spatial tolerance is 0.00001 meters.</p>
<h3 is-upgraded>Get Request with Lon Lat</h3>
<pre><code>{
  &#34;type&#34; : &#34;GetFeaturesByGeometryEvent&#34;,
  &#34;space&#34;: &#34;foo&#34;,
  &#34;params&#34;: {},
  &#34;tags&#34;: [
    [&#34;stadium&#34;, &#34;soccer&#34;]
  ],
  &#34;limit&#34;: 400,
  &#34;lat&#34;: -4.33806,
  &#34;lon&#34;: 15.3222,
  &#34;radius&#34;: 100,
  &#34;propertiesQuery&#34;: [[
    {
      &#34;key&#34;:&#34;properties.capacity&#34;,
      &#34;operation&#34;: &#34;EQUALS&#34;,
      &#34;values&#34;: [50000]
    }
  ]],
  &#34;selection&#34;: [&#34;properties.name&#34;,&#34;properties.capacity&#34;,&#34;properties.@ns:com:here:xyz&#34;,&#34;properties.occupant&#34;,&#34;properties.sport&#34;]
}
</code></pre>
<h3 is-upgraded>Post Request with Geometry</h3>
<pre><code>{
  &#34;type&#34; : &#34;GetFeaturesByGeometryEvent&#34;,
  &#34;space&#34;: &#34;foo&#34;,
  &#34;params&#34;: {},
  &#34;tags&#34;: [
    [&#34;stadium&#34;, &#34;soccer&#34;]
  ],
  &#34;limit&#34;: 400,
  &#34;radius&#34;: 100,
  &#34;geometry&#34;: {
        &#34;type&#34;: &#34;Point&#34;,
        &#34;coordinates&#34;: [
          15.3222,
          -4.33806
        ]
      },
  &#34;propertiesQuery&#34;: [[
    {
      &#34;key&#34;:&#34;properties.capacity&#34;,
      &#34;operation&#34;: &#34;EQUALS&#34;,
      &#34;values&#34;: [50000]
    }
  ]],
  &#34;selection&#34;: [&#34;properties.name&#34;,&#34;properties.capacity&#34;,&#34;properties.@ns:com:here:xyz&#34;,&#34;properties.occupant&#34;,&#34;properties.sport&#34;]
}
</code></pre>
<h3 is-upgraded>Success</h3>
<pre><code>{
  &#34;type&#34;: &#34;FeatureCollection&#34;,  //The type of the response.
  &#34;features&#34;: [                 //The features that were found in random order.
    {
      &#34;geometry&#34;: {
        &#34;type&#34;: &#34;Point&#34;,
        &#34;coordinates&#34;: [
          15.3222,
          -4.33806
        ]
      },
      &#34;id&#34;: &#34;Q3495887&#34;,
      &#34;type&#34;: &#34;Feature&#34;,
      &#34;properties&#34;: {
        &#34;name&#34;: &#34;Stade Tata Raphaël&#34;,
        &#34;@ns:com:here:xyz&#34;: {
          &#34;tags&#34;: [
            &#34;stadium&#34;,
            &#34;soccer&#34;
          ],
          &#34;version&#34;: 36879      //The space-version of the feature within the history of its space.
        },
        &#34;occupant&#34;: &#34;Daring Club Motema Pembe&#34;,
        &#34;sport&#34;: &#34;association football&#34;,
        &#34;capacity&#34;: 50000
      }
    }
  ]
}
</code></pre>
<h3 is-upgraded>Error</h3>
<pre><code>{
  &#34;type&#34;: &#34;ErrorResponse&#34;,              //The type of the response.
  &#34;error&#34;: &#34;NotImplemented&#34;,            //Signaling that this lambda does not implement the event.
  &#34;errorMessage&#34;: &#34;Requesting features by geomtery is not supported.&#34;
}
</code></pre>


      </google-codelab-step>
    
      <google-codelab-step label="IterateFeaturesEvent" duration="0">
        <p>Ask the XYZ Connector to iterate above all features in the given space, optionally filtered by those having certain tags. As there may be many million features in a space, the iterate request persists out of two phases. In the initial phase a request with a limit, tags and without a handle is send, which should start the iteration. The response should contain the first freatures and optionally a handle, when there are more features available. The client will then send another request using the handle to receive more results. That process continues until a feature collection without handle is returned by the space to signal that all features have been returned. Be aware that it is possible that while the iteration is done concurrent modifications are done to the space which may or may not be reflected in the iteration, dependent at the implementation of the feature.</p>
<p><strong>Warning:</strong> The iteration should be done in chunks of the same size, otherwise the space may respond with an error, because some implementations may use a paging method and not support iteration in chunks of different size!</p>
<pre><code>{
     &#34;type&#34;: &#34;IterateFeaturesEvent&#34;,     // The type of the event.
     &#34;space&#34;: &#34;foo&#34;,                     // The space for which the event was sent.
     &#34;params&#34;: {},                       // Parameters for the storage provider, as defined in the space configuration.
     &#34;tags&#34;: null,                       // Return features with any tag (same for []).
     &#34;limit&#34;: 500,                       // The maximal amount of features to be returned.
     &#34;handle&#34;: null                      // The handle, only needed for a continuation request.
}
</code></pre>
<h3 is-upgraded>Success</h3>
<pre><code>{
     &#34;type&#34;: &#34;FeatureCollection&#34;,        // The type of the response.
     &#34;features&#34;: [                       // The features that were found in a implementation dependent order.
          {
            &#34;geometry&#34;: {
                &#34;type&#34;: &#34;Point&#34;,
                &#34;coordinates&#34;: [
                    15.3222,
                    -4.33806
                ]
            },
            &#34;id&#34;: &#34;Q3495887&#34;,
            &#34;type&#34;: &#34;Feature&#34;,
            &#34;properties&#34;: {
                &#34;name&#34;: &#34;Stade Tata Raphaël&#34;,
                &#34;@ns:com:here:xyz&#34;: {
                    &#34;tags&#34;: [
                        &#34;stadium&#34;,
                        &#34;soccer&#34;
                    ]
                },
                &#34;occupant&#34;: &#34;Daring Club Motema Pembe&#34;,
                &#34;sport&#34;: &#34;association football&#34;,
                &#34;capacity&#34;: 50000
            }
        },
          ...                            // More features.
     ],
     &#34;handle&#34;: &#34;xasfet42ferv2d&#34;
}
</code></pre>
<h3 is-upgraded>Error</h3>
<pre><code>{
     &#34;type&#34;: &#34;FeatureCollection&#34;,        // The type of the response.
     &#34;error&#34;: &#34;NotSupported&#34;,            // Signaling that this lambda does not support the event.
     &#34;errorMessage&#34;: &#34;Iteration with a limit other than 1000 is not supported.&#34;
}
</code></pre>


      </google-codelab-step>
    
      <google-codelab-step label="SearchForFeaturesEvent" duration="0">
        <p>Ask the XYZ Connector to search for features using the given tags. The difference to the iteration is that this request does not allow to iterate through the results and the order of the features is random.</p>
<p><strong>Note:</strong> It is often much faster to perform a search than an iteration, because the results do not need to be ordered, therefore a search should preferred whenever possible.</p>
<pre><code>{
     &#34;type&#34;: &#34;SearchForFeaturesEvent&#34;,   // The type of the event.
     &#34;space&#34;: &#34;foo&#34;,                     // The space for which the event was sent.
     &#34;params&#34;: {},                       // Parameters for the storage provider, as defined in the space configuration.
     &#34;tags&#34;: [                           // Only return features with the tags:
          [&#34;stadium&#34;, &#34;soccer&#34;]          // &#34;stadium&#34; AND &#34;soccer&#34;
     ],
     &#34;limit&#34;: 400
}
</code></pre>
<h3 is-upgraded>Success</h3>
<pre><code>{
     &#34;type&#34;: &#34;FeatureCollection&#34;,        // The type of the response.
     &#34;features&#34;: [                       // The features that were found in random order.
          {
            &#34;geometry&#34;: {
                &#34;type&#34;: &#34;Point&#34;,
                &#34;coordinates&#34;: [
                    15.3222,
                    -4.33806
                ]
            },
            &#34;id&#34;: &#34;Q3495887&#34;,
            &#34;type&#34;: &#34;Feature&#34;,
            &#34;properties&#34;: {
                &#34;name&#34;: &#34;Stade Tata Raphaël&#34;,
                &#34;@ns:com:here:xyz&#34;: {
                    &#34;tags&#34;: [
                        &#34;stadium&#34;,
                        &#34;soccer&#34;
                    ]
                },
                &#34;occupant&#34;: &#34;Daring Club Motema Pembe&#34;,
                &#34;sport&#34;: &#34;association football&#34;,
                &#34;capacity&#34;: 50000
            }
        },
          ...                            // More features.
     ],
     &#34;count&#34;: 510000000,                 // The total amount of features that were found.
     &#34;estimated&#34;: false                  // If the total amount is only an estimation.
}
</code></pre>
<h3 is-upgraded>Error</h3>
<pre><code>{
     &#34;type&#34;: &#34;FeatureCollection&#34;,        // The type of the response.
     &#34;error&#34;: &#34;NotImplemented&#34;,          // Signaling that this lambda does not implement the event.
     &#34;errorMessage&#34;: &#34;Not implemented.&#34;
}
</code></pre>


      </google-codelab-step>
    
      <google-codelab-step label="DeleteFeaturesByTagEvent" duration="0">
        <p>Ask the space data provider to delete all features that match the provided tags. If not tags are provided, then all features in the space should be deleted.</p>
<pre><code>{
     &#34;type&#34;: &#34;DeleteFeaturesByTagEvent&#34;, // The type of the event.
     &#34;params&#34;: {},                       // Parameters for the storage provider, as defined in the space configuration.
     &#34;space&#34;: &#34;foo&#34;,                     // The space for which the event was sent.
     &#34;tags&#34;: null                        // Special event that requests to delete all features in the space.
}
</code></pre>
<h3 is-upgraded>Success</h3>
<pre><code>{
     &#34;type&#34;: &#34;FeatureCollection&#34;,        // The type of the response.
     &#34;count&#34;: 5312343432                 // The amount of features that were deleted.
}     
</code></pre>
<h3 is-upgraded>Error</h3>
<pre><code>{
     &#34;type&#34;: &#34;FeatureCollection&#34;,        // The type of the response.
     &#34;error&#34;: &#34;NotImplemented&#34;,          // Signaling that this lambda does not implement the event.
     &#34;errorMessage&#34;: &#34;Not implemented.&#34;
}
</code></pre>


      </google-codelab-step>
    
      <google-codelab-step label="LoadFeaturesEvent" duration="0">
        <p>Ask the XYZ Connector to return all features with a specific ‘id&#39; and ‘uuid&#39;. This request differs from the <em>GetFeaturesByIdEvent</em> in that it may request features in two states, the HEAD state and the EDITED state. If the data provider does not have a history, it may simply use the same implementation as for the <em>GetFeaturesByIdEvent</em>.</p>
<p>If the data provider does have a history, then it should return the features in the HEAD state (so the latest state) and in the requested state (the EDITED state). Therefore this event may return the same feature twice, ones in the HEAD state and ones in the requested EDITED state. The space gateway will then merge changes done by the client with those done concurrently by other clients. If that is not possible the gateway API will automatically respond to the client with a corresponding HTTP 409 Conflict.</p>
<p><strong>This request is a preparation request for a ModifyFeaturesEvent.</strong></p>
<p>In the example to the right the feature with the ‘id&#39; &#34;Q3495887&#34; has been edited while the client was doing modifications to it. If the client did not modify the &#34;name&#34; property, then the space gateway will detect that the changes can be merged and it will merge the changes automatically, so that the resulting object will have the fixed typo and the changes by the client.</p>
<p>If the client has as well modified the &#34;name&#34; property, the space gateway API will detect that and respond with a 409 Conflict to signal that the issue must be solved by the client.</p>
<pre><code>{
     &#34;type&#34;: &#34;LoadFeaturesEvent&#34;,        // The type of the event.
     &#34;params&#34;: {},                       // Parameters for the storage provider, as defined in the space configuration.
     &#34;space&#34;: &#34;foo&#34;,                     // The space for which the event was sent.
     &#34;idsMap&#34;: {                         // The id&#39;s and uuids of the features requested.
          &#34;Q3495887&#34;: &#34;sdf43t43gdfwef&#34;,  // Request the HEAD and &#34;sdf43t43gdfwef&#34; state of &#34;Q3495887&#34;.
          &#34;Xfre5866&#34;: null               // Request only the HEAD state of &#34;Xfre5866&#34;.
     }
}
</code></pre>
<h3 is-upgraded>Success</h3>
<pre><code>{
     &#34;type&#34;: &#34;FeatureCollection&#34;,        // The type of the response.
     &#34;features&#34;: [                       // The features that were found in random order.
          // This is the HEAD state of &#34;Q3495887&#34;
          {
            &#34;geometry&#34;: {
                &#34;type&#34;: &#34;Point&#34;,
                &#34;coordinates&#34;: [
                    15.3222,
                    -4.33806
                ]
            },
            &#34;id&#34;: &#34;Q3495887&#34;,
            &#34;type&#34;: &#34;Feature&#34;,
            &#34;properties&#34;: {
                &#34;name&#34;: &#34;Stade Tata Raphaël&#34;,  // &lt;-- The typo &#34;Stude&#34;-&gt;&#34;Stade&#34; was modified!
                &#34;@ns:com:here:xyz&#34;: {
                         &#34;uuid&#34;: &#34;b53ee914-6b40-11e8-adc0-fa7ae01bbebc&#34;,
                    &#34;tags&#34;: [
                        &#34;stadium&#34;,
                        &#34;soccer&#34;
                    ]
                },
                &#34;occupant&#34;: &#34;Daring Club Motema Pembe&#34;,
                &#34;sport&#34;: &#34;association football&#34;,
                &#34;capacity&#34;: 50000
            }
        },
          // This is the EDITED state of &#34;Q3495887&#34;, because the uuid in the space namespace is 
          // the same as the requested one (sdf43t43gdfwef).
          {
            &#34;geometry&#34;: {
                &#34;type&#34;: &#34;Point&#34;,
                &#34;coordinates&#34;: [
                    15.3222,
                    -4.33806
                ]
            },
            &#34;id&#34;: &#34;Q3495887&#34;,
            &#34;type&#34;: &#34;Feature&#34;,
            &#34;properties&#34;: {
                &#34;name&#34;: &#34;Stude Tata Raphaël&#34;,          // &lt;-- Name with typo!
                &#34;@ns:com:here:xyz&#34;: {
                         &#34;uuid&#34;: &#34;b53ee914-6b40-11e8-adc0-fa7ae01bbebc&#34;,
                    &#34;tags&#34;: [
                        &#34;stadium&#34;,
                        &#34;soccer&#34;
                    ]
                },
                &#34;occupant&#34;: &#34;Daring Club Motema Pembe&#34;,
                &#34;sport&#34;: &#34;association football&#34;,
                &#34;capacity&#34;: 50000
            }
        }
          // No feature &#39;Xfre5866&#39; does exist, therefore it is not returned.
     ]
}
</code></pre>
<h3 is-upgraded>Error</h3>
<pre><code>{
     &#34;type&#34;: &#34;FeatureCollection&#34;,        // The type of the response.
     &#34;error&#34;: &#34;NotImplemented&#34;,          // Signaling that this lambda does not implement the event.
     &#34;errorMessage&#34;: &#34;Not implemented.&#34;
}
</code></pre>


      </google-codelab-step>
    
      <google-codelab-step label="ModifyFeaturesEvent" duration="0">
        <p>Ask the XYZ Connector to modify features.</p>
<p>An insert should fail, if an object already exist.</p>
<p>An update should fail, if the object does not exist or if the existing object does not have the same uuid as the object given in the update event. The data provider needs to calculate the new uuid when the update is successful. Basically a client will not touch the uuid property, therefore it will refer to the state that the client modified and when an update is done, then it should match the current HEAD state, when it does not, then another client has done a concurrent chance which the current client is not aware of and the update must fail. If no uuid is provided, the update should not be atomic, therefore it must succeed in any case, when such an object exists.</p>
<p>For deleting features its the same, if the current HEAD state does not match the provided uuid, then the delete must fail. However, when as uuid null is provided, the delete should be done in any case.</p>
<p>If a modification should be done transactional, then either all changes must be successful or no change must be done at all (data must stay unmodified, when one insert, update or delete fails). Not all data providers will support transactions.</p>
<pre><code>{
     &#34;type&#34;: &#34;ModifyFeaturesEvent&#34;,      // The type of the event.
     &#34;space&#34;: &#34;foo&#34;,                     // The space for which the event was sent.
     &#34;params&#34;: {},                       // Parameters for the storage provider, as defined in the space configuration.
     &#34;insertFeatures&#34;: [                 // All features that should be inserted.
          {
            &#34;geometry&#34;: {
                &#34;type&#34;: &#34;Point&#34;,
                &#34;coordinates&#34;: [
                    14.3222,
                    -2.32506
                ]
            },
            &#34;type&#34;: &#34;Feature&#34;,
            &#34;properties&#34;: {
                &#34;name&#34;: &#34;My Car&#34;,
                &#34;@ns:com:here:xyz&#34;: {
                    &#34;tags&#34;: [
                        &#34;yellow&#34;
                    ]
                }
            }
        }
     ],
     &#34;prefixId&#34;: null,                   // If not null, all features for which an &#39;id&#39; is generated 
                                         // must be prefixed with this string.
     &#34;updateFeatures&#34;: [                 // All features that should be updated (full new object state).
          {
            &#34;geometry&#34;: {
                &#34;type&#34;: &#34;Point&#34;,
                &#34;coordinates&#34;: [
                    15.3222,
                    -4.33806
                ]
            },
            &#34;id&#34;: &#34;Q3495887&#34;,
            &#34;type&#34;: &#34;Feature&#34;,
            &#34;properties&#34;: {
                &#34;name&#34;: &#34;Stade Tata Raphaël&#34;,
                &#34;@ns:com:here:xyz&#34;: {
                         &#34;uuid&#34;: &#34;b53ee914-6b40-11e8-adc0-fa7ae01bbebc&#34;,          // The uuid of the feature state
                    &#34;tags&#34;: [
                        &#34;stadium&#34;,
                        &#34;soccer&#34;
                    ]
                },
                &#34;occupant&#34;: &#34;Daring Club Motema Pembe&#34;,
                &#34;sport&#34;: &#34;association football&#34;,
                &#34;capacity&#34;: 50000
            }
        }
     ],
     &#34;deleteFeatures&#34;: {                 // All features to be deleted.
          &#34;X5543245&#34;: &#34;sdfsf2fwefsd&#34;,    // Atomic delete requested, uuid should match the HEAD state.
          &#34;Y2342343&#34;: null               // Simple delete requested, just delete HEAD.
     },
     &#34;transaction&#34;: false                // If all inserts, updates and deletes should succeed or if 
                                         // partial failures are allowed (not transactional).          
}
</code></pre>
<h3 is-upgraded>Success</h3>
<pre><code>{
     &#34;type&#34;: &#34;FeatureCollection&#34;,        // The type of the response.
     &#34;features&#34;: [                       // The new HEAD state of all inserted or updated features:
          // The inserted feature:
          {
            &#34;geometry&#34;: {
                &#34;type&#34;: &#34;Point&#34;,
                &#34;coordinates&#34;: [
                    14.3222,
                    -2.32506
                ]
            },
               &#34;id&#34;: &#34;X4232352&#34;,          // The id was generated.
            &#34;type&#34;: &#34;Feature&#34;,
            &#34;properties&#34;: {
                &#34;name&#34;: &#34;My Car&#34;,
                &#34;@ns:com:here:xyz&#34;: {
                    &#34;tags&#34;: [
                        &#34;yellow&#34;
                    ],
                         &#34;uuid&#34;: &#34;b53ee914-6b40-11e8-adc0-fa7ae01bbebc&#34;   // The uuid of the feature state 
                }
            }
        },
          // The updated feature:
          {
            &#34;geometry&#34;: {
                &#34;type&#34;: &#34;Point&#34;,
                &#34;coordinates&#34;: [
                    15.3222,
                    -4.33806
                ]
            },
            &#34;id&#34;: &#34;Q3495887&#34;,
            &#34;type&#34;: &#34;Feature&#34;,
            &#34;properties&#34;: {
                &#34;name&#34;: &#34;Stade Tata Raphaël&#34;,
                &#34;@ns:com:here:xyz&#34;: {
                         &#34;uuid&#34;: &#34;b53ee914-6b40-11e8-adc0-fa7ae01bbebc&#34;,  // The uuid of the feature state
                         &#34;puuid&#34;: &#34;b53ee914-6b40-11e8-adc0-fa7ae01bbebc&#34;, // The uuid of the parent/previous feature state
                    &#34;tags&#34;: [
                        &#34;stadium&#34;,
                        &#34;soccer&#34;
                    ]
                },
                &#34;occupant&#34;: &#34;Daring Club Motema Pembe&#34;,
                &#34;sport&#34;: &#34;association football&#34;,
                &#34;capacity&#34;: 50000
            }
        }
     ],
     &#34;insertedIds&#34;: [&#34;X4232352&#34;],         // The generated identifier of the inserted feature.
     &#34;insertErrors&#34;: {},                  // No error occurred.
     &#34;updateErrors&#34;: {},                  // No error occurred.
     &#34;deleteErrors&#34;: {
          &#34;Y2342343&#34;: null,               // The feature was deleted.
          &#34;X5543245&#34;: &#34;Conflict, uuid does not match&#34; // This feature is not deleted, because the uuid does not match
     }
}
</code></pre>
<h3 is-upgraded>Error</h3>
<pre><code>{
     &#34;type&#34;: &#34;FeatureCollection&#34;,         // The type of the response.
     &#34;error&#34;: &#34;Conflict&#34;,
     &#34;errorMessage&#34;: &#34;Failed to delete feature with id &#39;X5543245&#39;, because the current HEAD state differs. Transaction was aborted, data stays unchanged.&#34;
}
</code></pre>


      </google-codelab-step>
    
      <google-codelab-step label="ModifySpaceEvent" duration="0">
        <p>Ask the XYZ Connector to create, update or delete a space itself. This event may be used to setup, update or tear-down dependent data sources.</p>
<pre><code>{
  &#34;type&#34;: &#34;ModifySpaceEvent&#34;,                               //The type of the event.
  &#34;space&#34;: &#34;foo&#34;,                                           //The space for which the event was sent.
  &#34;operation&#34;: &#34;CREATE&#34; | &#34;UPDATE&#34; | &#34;DELETE&#34;,              //The operation which is about to be done.
  &#34;params&#34;: {}
  &#34;spaceDefinition&#34;: {                                      //The space definition of the affected space.
    &#34;id&#34;: &#34;foo&#34;,                                            //The unique identifier of the space.
    &#34;title&#34;: &#34;A space&#34;,                                     //A human readable title of the space.
    &#34;description&#34;: &#34;The description of the space&#34;,          //A human readable description of the space and it&#39;s content.
    &#34;owner&#34;: &#34;HERE-abcd0123-abcd-0123-abcd-abcdef012345&#34;,   //The identifier of the owner of this space, most likely the HERE account ID.
    &#34;shared&#34;: true | false,                                 //If set to true, every authenticated user can read the features in the space.
    &#34;cacheTTL&#34;: 0,                                          //The maximum amount of seconds of how long to hold objects of this Space in a cache.
    &#34;enableUUID&#34;: false,                                    //If true, every state of the feature, will be assigned a UUID value.
    &#34;tags&#34;: [&#34;SomeTag&#34;, ...],                               //The list of tags to describe this Space.
    &#34;packages&#34;: [&#34;HERE&#34;, ...],                              //List of packages that this space belongs to.
    &#34;createdAt&#34;: 0123456789,                                //The creation timestamp.
    &#34;updatedAt&#34;: 0123456789,                                //The last update timestamp.
    &#34;searchableProperties&#34;: {                               //A map defined by the user which tells which of the feature&#39;s properties to be searchable.
        &#34;aTopLevelProperty&#34;: true,                          //The key is the name of the property (nested properties can be specified using the
        &#34;someAutoIndexedPropery&#34;: false,                    //dot-notation e.g.: some.nested.property) and the value is a boolean telling whether the
        &#34;a.nested.property&#34;: true,                          //property should be searchable or not.
        ...                                                 //Setting the value to false the property won&#39;t be searchable at all. (Even if the  property
    },                                                     //was chosen to be searchable by the automated property-search algorithm before)
    &#34;copyright&#34;: [                                          //Copyright information for the data in the space.
        {
            &#34;label&#34;: &#34;HERE&#34;,
            &#34;alt&#34;: &#34;HERE 2019, all rights reserved.&#34;
        },
        ...
    ],
    &#34;license&#34;: &#34;Apache-2.0&#34;,                                //A valid SPDC license identifier; See: https://spdx.org/licenses/
    &#34;storage&#34;: {                                            //The storage connector configuration.
        &#34;id&#34;: &#34;psql&#34;,
        &#34;params&#34;: {
            ...
        }
    },
    &#34;listeners&#34;: [                                          //The event listeners configuration.
        {                                                   //A listening connector get&#39;s only *informed* about events, but the XYZ hub doesn&#39;t expect / wait for any response.
            &#34;id&#34;: &#34;sns-publisher&#34;,
            &#34;eventTypes&#34;: [&#34;ModifyFeaturesEvent.response&#34;, ...],
            &#34;params&#34;: {
                ...
            }
        },
        ...
    ],
    &#34;processors&#34;: [                                         //The event processors configuration.
        {                                                   //A processing connector get&#39;s the specified events and can re-process them synchronously. The XYZ Hub waits for a response.
            &#34;id&#34;: &#34;rule-tagger&#34;,
            &#34;params&#34;: {
                ...
            }
        },
        ...
    ]
  }
}
</code></pre>
<h3 is-upgraded>Success</h3>
<pre><code>{
  &#34;type&#34;: &#34;SuccessResponse&#34;,      // The type of the response.
  &#34;status&#34;: &#34;OK&#34;                  // Space was created, updated or deleted successfully
}
</code></pre>
<h3 is-upgraded>Error</h3>
<pre><code>{
  &#34;type&#34;: &#34;ErrorResponse&#34;,          //The type of the response.
  &#34;error&#34;: &#34;Exception&#34;,             //Signaling that there was an error during the execution.
  &#34;errorMessage&#34;: &#34;Error when creating the table.&#34;
}
</code></pre>


      </google-codelab-step>
    
      <google-codelab-step label="RelocatedEvent" duration="0">
        <p>If an event or a response cannot be transferred directly, a RelocatedEvent could be sent instead, with the location of the original payload.</p>
<pre><code>{
  &#34;type&#34;: &#34;RelocatedEvent&#34;,                 //The type of the event.
  &#34;URI&#34;: &#34;s3://my-bucket/tmp/relocatedID&#34;   //A valid URI
}
</code></pre>


      </google-codelab-step>
    
      <google-codelab-step label="Response" duration="0">
        <p>The space gateway will accept only a XYZResponse as valid response. This response can have the following properties:</p>
<table>
<tr></tr>
<tr><td colspan="1" rowspan="1"><p>type</p>
</td><td colspan="1" rowspan="1"><p>String</p>
</td><td colspan="1" rowspan="1"><p>*</p>
</td><td colspan="1" rowspan="1"><p>&#34;FeatureCollection&#34;</p>
</td></tr>
<tr><td colspan="1" rowspan="1"><p>features</p>
</td><td colspan="1" rowspan="1"><p>Array&lt;Feature&gt;</p>
</td><td colspan="1" rowspan="1"><p>A list of features that represent the result for all.</p>
</td></tr>
<tr><td colspan="1" rowspan="1"><p>error</p>
</td><td colspan="1" rowspan="1"><p>String</p>
</td><td colspan="1" rowspan="1"><p>*</p>
</td><td colspan="1" rowspan="1"><p>To report a well known error condition.</p>
</td></tr>
<tr><td colspan="1" rowspan="1"><p>errorMessage</p>
</td><td colspan="1" rowspan="1"><p>String</p>
</td><td colspan="1" rowspan="1"><p>*</p>
</td><td colspan="1" rowspan="1"><p>An additional reason that provides details about the error.</p>
</td></tr>
<tr><td colspan="1" rowspan="1"><p>etag</p>
</td><td colspan="1" rowspan="1"><p>String</p>
</td><td colspan="1" rowspan="1"><p>*</p>
</td><td colspan="1" rowspan="1"><p>An E-Tag about the features that can be used by browsers and the gateway API for caching.</p>
</td></tr>
<tr><td colspan="1" rowspan="1"><p>handle</p>
</td><td colspan="1" rowspan="1"><p>String</p>
</td><td colspan="1" rowspan="1"><p>IterateFeaturesEvent</p>
</td><td colspan="1" rowspan="1"><p>Only valid for a response to a IterateFeaturesEvent and if provided, then it should contain the handle that can be used to query more results. If there are no more results, handle should be undefined or null.</p>
</td></tr>
<tr><td colspan="1" rowspan="1"><p>location</p>
</td><td colspan="1" rowspan="1"><p>String</p>
</td><td colspan="1" rowspan="1"><p>*</p>
</td><td colspan="1" rowspan="1"><p>When the original feature collection was larger than the maximal number of bytes allowed for AWS lambda responses (currently 6mb), than this holds the URI where the original response can be found.<br><br><strong>Warning: At the moment this feature is not yet supported by the gateway.</strong></p>
</td></tr>
<tr><td colspan="1" rowspan="1"><p>inserted</p>
</td><td colspan="1" rowspan="1"><p>Array&lt;String&gt;</p>
</td><td colspan="1" rowspan="1"><p>ModifyFeaturesEvent</p>
</td><td colspan="1" rowspan="1"><p>A list containing all IDs of features which have been successfully inserted to the space.</p>
</td></tr>
<tr><td colspan="1" rowspan="1"><p>updated</p>
</td><td colspan="1" rowspan="1"><p>Array&lt;String&gt;</p>
</td><td colspan="1" rowspan="1"><p>ModifyFeaturesEvent</p>
</td><td colspan="1" rowspan="1"><p>A list containing all IDs of features which have been successfully updated in the space.</p>
</td></tr>
<tr><td colspan="1" rowspan="1"><p>deleted</p>
</td><td colspan="1" rowspan="1"><p>Array&lt;String&gt;</p>
</td><td colspan="1" rowspan="1"><p>ModifyFeaturesEvent</p>
</td><td colspan="1" rowspan="1"><p>A list containing all IDs of features which have been successfully deleted from the space.</p>
</td></tr>
<tr><td colspan="1" rowspan="1"><p>failed</p>
</td><td colspan="1" rowspan="1"><p>Array&lt;Map&lt;String,String&gt;&gt;</p>
</td><td colspan="1" rowspan="1"><p>ModifyFeaturesEvent</p>
</td><td colspan="1" rowspan="1"><p>A list of maps that contain keys as: ‘id&#39;, ‘position&#39; and ‘message&#39;.</p>
</td></tr>
</table>


      </google-codelab-step>
    
      <google-codelab-step label="Errors" duration="0">
        <table>
<tr></tr>
<tr><td colspan="1" rowspan="1"><p>EXCEPTION</p>
</td><td colspan="1" rowspan="1"><p>An unexpected error (not further specified) happened while processing the request. This can result in an 500 Internal Server Error or 502 Bad Gateway.</p>
</td></tr>
<tr><td colspan="1" rowspan="1"><p>NOT_IMPLEMENTED</p>
</td><td colspan="1" rowspan="1"><p>An event that was sent to the connector failed, because the connector cannot process it. This will result in an 501 Not Implemented response.</p>
</td></tr>
<tr><td colspan="1" rowspan="1"><p>CONFLICT</p>
</td><td colspan="1" rowspan="1"><p>A conflict occurred when updating a feature. This will result in an 409 Conflict response.</p>
</td></tr>
<tr><td colspan="1" rowspan="1"><p>FORBIDDEN</p>
</td><td colspan="1" rowspan="1"><p>Indicates an authorization error. This will result in an 401 Forbidden response.</p>
</td></tr>
<tr><td colspan="1" rowspan="1"><p>TOO_MANY_REQUESTS</p>
</td><td colspan="1" rowspan="1"><p>The connector cannot handle the request due to a processing limitation in an upstream service or a database. This will result in an 429 Too Many Requests response.</p>
</td></tr>
<tr><td colspan="1" rowspan="1"><p>ILLEGAL_ARGUMENT</p>
</td><td colspan="1" rowspan="1"><p>Any service or remote function required to process the request was not reachable. This will result in a 502 Bad Gateway response.</p>
</td></tr>
<tr><td colspan="1" rowspan="1"><p>BAD_GATEWAY</p>
</td><td colspan="1" rowspan="1"><p>A space specific error happened, this error is proprietary to this space, further details can be found in the error message. All clients that do not understand this error should treat it like the standard Error, so as no further specified error.</p>
</td></tr>
<tr><td colspan="1" rowspan="1"><p>TIMEOUT</p>
</td><td colspan="1" rowspan="1"><p>The request was aborted due to a timeout. This will result in a HTTP 504 Gateway Timeout response.</p>
</td></tr>
</table>


      </google-codelab-step>
    
  </google-codelab>

  <script src="https://storage.googleapis.com/codelab-elements/native-shim.js"></script>
  <script src="https://storage.googleapis.com/codelab-elements/custom-elements.min.js"></script>
  <script src="https://storage.googleapis.com/codelab-elements/prettify.js"></script>
  <script src="https://storage.googleapis.com/codelab-elements/codelab-elements.js"></script>

</body>
</html>
